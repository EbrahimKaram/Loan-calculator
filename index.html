<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FZLLJPXEX6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-FZLLJPXEX6');
    </script>
    <meta charset="UTF-8">
    <title>Loan Payoff Chart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta property="og:title" content="Loan Payoff Chart" />
    <meta property="og:description" content="Visualize how your loan payments affect your balances over time. Add as many loans as you like." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://www.ebrahimkaram.com/Loan-calculator/images/LoanCalculator.gif">
    <meta property="og:image:type" content="image/gif">
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="400">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

    <style>
        :root {
            --primary-bg: #f7f8fa;
            --card-border-radius: 12px;
            --accent-color: #0d6efd;
        }

        body {
            background-color: var(--primary-bg);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            padding-bottom: 60px; /* Space for BMC button */
        }

        .bmc-float {
            position: fixed;
            right: 24px;
            bottom: 24px;
            z-index: 9999;
            pointer-events: auto;
        }

        @media (max-width: 600px) {
            .bmc-float {
                right: 8px;
                bottom: 8px;
            }
        }

        /* Summary Card Styling */
        .summary-card {
            background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
            color: white;
            border-radius: var(--card-border-radius);
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(13, 110, 253, 0.2);
        }
        
        .summary-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 2px;
        }
        
        .summary-value {
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* Loan Control Card Styling */
        .loan-control {
            background: #fff;
            border-radius: var(--card-border-radius);
            padding: 0;
            margin-bottom: 16px;
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
        }

        .loan-control:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .loan-header {
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .loan-header-title {
            font-weight: 600;
            color: #495057;
            border: none;
            background: transparent;
            font-size: 1rem;
            width: 100%;
        }
        
        .loan-header-title:focus {
            outline: none;
            background: #fff;
            box-shadow: inset 0 -1px 0 #0d6efd;
        }

        .loan-body {
            padding: 16px;
        }

        .btn-remove-loan {
            color: #dc3545;
            padding: 4px 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        
        .btn-remove-loan:hover {
            background: #fee2e2;
        }

        .input-group-text {
            background-color: #f8f9fa;
            border-color: #dee2e6;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .form-label-sm {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 4px;
            display: block;
        }

        #chart {
            min-height: 400px;
            height: 60vh;
            background: #fff;
            border-radius: var(--card-border-radius);
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.07);
            padding: 16px;
            resize: both;
            overflow: active;
        }

        #sidebar {
            width: 320px;
            min-width: 300px;
            max-width: 90vw;
            border-radius: var(--card-border-radius);
            position: relative;
            z-index: 100;
        }

        #sidebar .resize-handle {
            position: absolute;
            top: 0;
            right: 0;
            width: 12px;
            height: 100%;
            cursor: ew-resize;
            background: transparent;
            z-index: 10;
        }
        
        #sidebar .resize-handle::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 4px;
            height: 40px;
            width: 4px;
            background-color: #dee2e6;
            border-radius: 10px;
            transform: translateY(-50%);
        }

        #sidebar.collapsed {
            display: none !important;
        }

        #chart-wrapper {
            flex: 1 1 0%;
        }

        #chart-wrapper.expanded {
            flex-basis: 100% !important;
        }

        @media (max-width: 768px) {
            .loan-control {
                font-size: 0.97em;
            }

            #chart {
                min-height: 300px;
                height: 50vw;
            }

            h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>


    <div class="container-fluid pt-3">
        <header class="d-flex justify-content-between align-items-center mb-4 pb-2 border-bottom">
            <div class="d-flex align-items-center gap-3">
                 <button id="toggle-controls-btn" class="btn btn-outline-primary btn-sm rounded-pill">
                    <i class="bi bi-layout-sidebar"></i> <span class="d-none d-sm-inline">Toggle Sidebar</span>
                </button>
                <div>
                    <h3 class="mb-0 fw-bold text-primary"><i class="bi bi-graph-up-arrow me-2"></i>Payoff Simulator</h3>
                    <p class="text-muted small mb-0">Visualize and plan your debt-free journey</p>
                </div>
            </div>
            <div>
                <a href="https://github.com/EbrahimKaram/Loan-calculator" target="_blank" class="btn btn-outline-dark btn-sm rounded-pill">
                    <i class="bi bi-github me-1"></i> GitHub
                </a>
            </div>
        </header>

        <div class="d-flex flex-column flex-md-row gap-3">
            <!-- Sidebar Controls -->
            <div id="sidebar" class="bg-white shadow-sm p-0 d-flex flex-column" style="max-height: calc(100vh - 120px);">
                <div class="resize-handle"></div>
                
                <div class="p-3 border-bottom bg-light">
                     <!-- Summary Dashboard Inside Sidebar -->
                    <div id="summary-section" class="summary-card">
                        <div class="row g-2 text-center">
                            <div class="col-6">
                                <div class="summary-label">Total Debt</div>
                                <div class="summary-value" id="total-balance">$0</div>
                            </div>
                            <div class="col-6">
                                <div class="summary-label">Monthly Payment</div>
                                <div class="summary-value" id="total-payment">$0</div>
                            </div>
                            <div class="col-12 border-top border-white border-opacity-25 mt-2 pt-2">
                                <div class="summary-label">Debt Free Date</div>
                                <div class="summary-value" id="payoff-date">â€”</div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                         <button id="add-loan-btn" class="btn btn-primary btn-sm flex-grow-1 shadow-sm"><i class="bi bi-plus-lg me-1"></i> Add Loan</button>
                         <div class="dropdown">
                            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-three-dots-vertical"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" id="import-csv-trigger"><i class="bi bi-file-earmark-arrow-up me-2"></i>Import CSV</a></li>
                                <li><a class="dropdown-item" href="#" id="download-template-btn"><i class="bi bi-file-earmark-arrow-down me-2"></i>Download Template</a></li>
                            </ul>
                        </div>
                         <input type="file" id="import-csv" accept=".csv" style="display:none">
                    </div>
                </div>

                <div id="controls" class="p-3 overflow-y-auto custom-scrollbar"></div>
            </div>

            <!-- Chart Area -->
            <div id="chart-wrapper" class="flex-grow-1">
                <div id="chart"></div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap Bundle JS (needed for dropdowns) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let loans = [
            { name: "Car Loan", balance: 15000, rate: 0.05, payment: 300 },
            { name: "Student Loan", balance: 40000, rate: 0.045, payment: 500 },
            { name: "Credit Card", balance: 8000, rate: 0.18, payment: 200 }
        ];

        const controlsDiv = document.getElementById('controls');
        const chart = echarts.init(document.getElementById('chart'));
        window.addEventListener('resize', () => chart.resize());
        const chartDiv = document.getElementById('chart');
        let resizeObserver = new ResizeObserver(() => chart.resize());
        resizeObserver.observe(chartDiv);

        // Sidebar toggle
        const toggleBtn = document.getElementById('toggle-controls-btn');
        const sidebar = document.getElementById('sidebar');
        const chartWrapper = document.getElementById('chart-wrapper');
        
        function updateToggleBtnText(isCollapsed) {
             const icon = isCollapsed ? '<i class="bi bi-layout-sidebar-inset"></i>' : '<i class="bi bi-layout-sidebar"></i>';
             const text = isCollapsed ? 'Show Sidebar' : 'Hide Sidebar';
             toggleBtn.innerHTML = `${icon} <span class="d-none d-sm-inline">${text}</span>`;
        }

        toggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            const isCollapsed = sidebar.classList.contains('collapsed');
            if (isCollapsed) {
                chartWrapper.classList.add('expanded');
                chartWrapper.classList.remove('collapsed');
            } else {
                chartWrapper.classList.remove('expanded');
                chartWrapper.classList.add('collapsed');
            }
            updateToggleBtnText(isCollapsed);
            setTimeout(() => chart.resize(), 310);
        });

        // Sidebar resize logic
        const sidebarHandle = document.querySelector('#sidebar .resize-handle');
        let isResizing = false;
        let startX, startWidth;
        sidebarHandle.addEventListener('mousedown', function (e) {
            isResizing = true;
            startX = e.clientX;
            startWidth = sidebar.offsetWidth;
            document.body.style.userSelect = 'none';
        });
        document.addEventListener('mousemove', function (e) {
            if (!isResizing) return;
            let newWidth = Math.max(180, Math.min(window.innerWidth * 0.9, startWidth + (e.clientX - startX)));
            sidebar.style.width = newWidth + 'px';
            sidebar.style.minWidth = newWidth + 'px';
            setTimeout(() => chart.resize(), 0);
        });
        document.addEventListener('mouseup', function () {
            if (isResizing) {
                isResizing = false;
                document.body.style.userSelect = '';
            }
        });

        // Render controls
        function renderControls() {
            controlsDiv.innerHTML = '';
            loans.forEach((loan, idx) => {
                const paymentMax = Math.ceil(loan.balance + loan.balance * loan.rate / 12);
                const col = document.createElement('div');
                col.className = 'loan-control'; 
                col.innerHTML = `
    <div class="loan-header">
        <input type="text" class="loan-header-title" value="${loan.name}" data-field="name" data-idx="${idx}" placeholder="Loan Name">
        <button class="btn btn-link btn-remove-loan" data-remove="${idx}" title="Remove Loan">
            <i class="bi bi-trash" style="pointer-events: none;"></i>
        </button>
    </div>
    <div class="loan-body">
        <div class="mb-3">
            <label class="form-label-sm">Balance</label>
            <div class="input-group input-group-sm">
                <span class="input-group-text">$</span>
                <input type="number" class="form-control" min="0" step="100" value="${loan.balance}" data-field="balanceNumber" data-idx="${idx}">
            </div>
        </div>
        
        <div class="mb-3">
             <label class="form-label-sm d-flex justify-content-between align-items-center">
                <span>Interest Rate</span>
                <div class="input-group input-group-sm" style="width: 85px;">
                    <input type="number" class="form-control text-end px-1" min="0" max="35" step="0.1" value="${(loan.rate * 100).toFixed(1)}" 
                        data-field="rateNumber" data-idx="${idx}">
                    <span class="input-group-text px-1">%</span>
                </div>
            </label>
            <input type="range" class="form-range" min="0" max="35" step="0.1" value="${(loan.rate * 100).toFixed(1)}"
            data-field="rate" data-idx="${idx}">
        </div>

        <div class="mb-3">
            <label class="form-label-sm d-flex justify-content-between">
                <span>Monthly Payment</span>
            </label>
            <div class="input-group input-group-sm mb-1">
                <span class="input-group-text">$</span>
                <input type="number" class="form-control" min="10" max="${paymentMax * 1.5}" step="10" value="${loan.payment}"
            data-field="paymentNumber" data-idx="${idx}">
            </div>
            <input type="range" class="form-range" min="10" max="${paymentMax}" step="10" value="${loan.payment}"
            data-field="payment" data-idx="${idx}">
        </div>

        <div class="d-flex justify-content-between align-items-center pt-2 border-top">
            <small class="text-muted">Last Payment</small> 
            <small class="fw-bold text-dark last-payment-date" data-idx="${idx}">${loan.lastPaymentDate || 'â€”'}</small>
        </div>
    </div>
`;
                controlsDiv.appendChild(col);
            });
            updateSummary();
        }

        function updateSummary() {
            // Calculate totals
            let totalBalance = loans.reduce((sum, loan) => sum + loan.balance, 0);
            let totalPayment = loans.reduce((sum, loan) => sum + loan.payment, 0);
            
            // Find latest payoff date
            let latestDate = null;
            loans.forEach(loan => {
                if (loan.lastPaymentDate && loan.lastPaymentDate !== 'â€”') {
                    let date = new Date(loan.lastPaymentDate);
                     if (!latestDate || date > latestDate) {
                        latestDate = date;
                    }
                }
            });

            // Update DOM
            const currencyFmt = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
            document.getElementById('total-balance').textContent = currencyFmt.format(totalBalance);
            document.getElementById('total-payment').textContent = currencyFmt.format(totalPayment);
            document.getElementById('payoff-date').textContent = latestDate ? latestDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : 'â€”';
        }

        // CSV Import
        document.getElementById('import-csv-trigger').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('import-csv').click();
        });
        document.getElementById('import-csv').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (evt) {
                const text = evt.target.result;
                const parseCSVLine = (line) => {
                    const values = [];
                    let current = '', insideQuotes = false;
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"' && (i === 0 || line[i - 1] !== '\\')) {
                            insideQuotes = !insideQuotes;
                        } else if (char === ',' && !insideQuotes) {
                            values.push(current.trim()); current = '';
                        } else {
                            current += char;
                        }
                    }
                    values.push(current.trim());
                    return values;
                };
                const lines = text.split(/\r?\n/).filter(l => l.trim());
                if (lines.length < 2) return;
                const headers = parseCSVLine(lines[0]).map(h => h.trim().toLowerCase());
                const nameIdx = headers.indexOf('name');
                const balanceIdx = headers.indexOf('balance');
                const rateIdx = headers.indexOf('rate');
                const paymentIdx = headers.indexOf('payment');
                if (nameIdx === -1 || balanceIdx === -1 || rateIdx === -1 || paymentIdx === -1) {
                    alert('CSV must have headers: name,balance,rate,payment'); return;
                }
                const cleanNumber = (str) => parseFloat(str.replace(/[\$, %]/g, '').replace(/,/g, '')) || 0;
                const imported = [];
                for (let i = 1; i < lines.length; i++) {
                    const row = parseCSVLine(lines[i]);
                    if (row.length < 4) continue;
                    imported.push({
                        name: row[nameIdx].replace(/^"|"$/g, '').trim(),
                        balance: cleanNumber(row[balanceIdx]),
                        rate: cleanNumber(row[rateIdx]) / 100,
                        payment: cleanNumber(row[paymentIdx])
                    });
                }
                if (imported.length) {
                    loans = imported;
                    renderControls();
                    updateChart();
                } else {
                    alert('No valid loans found in CSV.');
                }
            };
            reader.readAsText(file);
        });

        ///// update last payment date
        function updateLastPaymentDates() {
            loans.forEach((loan, idx) => {
                const el = document.querySelector(`.last-payment-date[data-idx="${idx}"]`);
                if (el) el.textContent = loan.lastPaymentDate || 'â€”';
            });
            updateSummary();
        }

        // Download template
        document.getElementById('download-template-btn').addEventListener('click', (e) => {
            e.preventDefault(); 
            const csv = 'name,balance,rate,payment\nCar Loan,15000,5,300\nStudent Loan,40000,4.5,500\nCredit Card,8000,18,200\n';
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'loan_template.csv';
            document.body.appendChild(a); a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Input handling
        controlsDiv.addEventListener('input', e => {
            const field = e.target.dataset.field;
            const idx = e.target.dataset.idx;
            if (idx === undefined) return;
            const syncValue = val => parseFloat(val) || 0;
            
            if (field === 'rate' || field === 'rateNumber') {
                const val = syncValue(e.target.value);
                loans[idx].rate = val / 100;
                // Update range slider if number input changed
                if (field === 'rateNumber') {
                    const rangeInput = controlsDiv.querySelector(`input[data-field="rate"][data-idx="${idx}"]`);
                    if (rangeInput) rangeInput.value = val;
                }
                
                // Update number input if range changed
                if (field === 'rate') {
                     const numberInput = controlsDiv.querySelector(`input[data-field="rateNumber"][data-idx="${idx}"]`);
                     if (numberInput) numberInput.value = val;
                }
                
                adjustPaymentMax(idx);
            } else if (field === 'payment' || field === 'paymentNumber') {
                const val = Math.max(syncValue(e.target.value), 0);
                loans[idx].payment = val;
                controlsDiv.querySelector(`input[data-field="${field === 'payment' ? 'paymentNumber' : 'payment'}"][data-idx="${idx}"]`).value = val;
            } else if (field === 'balance' || field === 'balanceNumber') {
                const val = Math.max(syncValue(e.target.value), 0);
                loans[idx].balance = val;
                adjustPaymentMax(idx);
            } else if (field === 'name') {
                loans[idx].name = e.target.value;
            }
            updateChart();
            if (field === 'balance' || field === 'balanceNumber' || field === 'payment' || field === 'paymentNumber') {
                updateSummary();
            }
        });
        function adjustPaymentMax(idx) {
            const slider = controlsDiv.querySelector(`input[data-field="payment"][data-idx="${idx}"]`);
            // We only adjust the slider max, not the number input max to allow flexibility
            if (slider) {
                const maxVal = Math.ceil(loans[idx].balance + loans[idx].balance * loans[idx].rate / 12);
                slider.max = maxVal;
                // Don't auto-cap the current payment if user typed it, only if they are using the slider
                if (loans[idx].payment > maxVal && document.activeElement === slider) {
                    loans[idx].payment = maxVal;
                    slider.value = maxVal;
                    const numberInput = controlsDiv.querySelector(`input[data-field="paymentNumber"][data-idx="${idx}"]`);
                    if(numberInput) numberInput.value = maxVal;
                }
            }
        }
        
        controlsDiv.addEventListener('click', e => {
            const removeBtn = e.target.closest('[data-remove]');
            if (removeBtn) {
                loans.splice(parseInt(removeBtn.dataset.remove, 10), 1);
                chart.clear();
                renderControls();
                updateChart();
            }
        });
        
        document.getElementById('add-loan-btn').addEventListener('click', () => {
            loans.push({ name: `Loan ${loans.length + 1}`, balance: 10000, rate: 0.05, payment: 200 });
            renderControls();
            updateChart();
        });

        // Loan calculate Balances
        function calculateBalances(loans) {
            let allBalances = loans.map(l => [l.balance]);
            let months = 0, maxMonths = 0;
            let payoffMonths = Array(loans.length).fill(null); // store month of last payment

            while (true) {
                let allPaid = true;
                months++;
                for (let i = 0; i < loans.length; i++) {
                    let bal = allBalances[i][months - 1];
                    if (bal > 0) {
                        allPaid = false;
                        let interest = bal * (loans[i].rate / 12);
                        let newBal = bal + interest - loans[i].payment;
                        if (newBal <= 0 && payoffMonths[i] === null) {
                            payoffMonths[i] = months; // record payoff month
                        }
                        allBalances[i][months] = Math.max(newBal, 0);
                    } else {
                        allBalances[i][months] = 0;
                    }
                }
                if (allPaid || months > 600) break;
                maxMonths = months;
            }

            // Calculate payoff dates
            let now = new Date();
            loans.forEach((loan, i) => {
                if (payoffMonths[i] !== null) {
                    let totalMonths = now.getMonth() + payoffMonths[i];
                    let year = now.getFullYear() + Math.floor(totalMonths / 12);
                    let month = (totalMonths % 12) + 1;
                    loan.lastPaymentDate = new Date(year, month - 1, 1).toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                } else {
                    loan.lastPaymentDate = 'â€”';
                }
            });

            return { months: Array.from({ length: maxMonths + 1 }, (_, i) => i), balances: allBalances };
        }


        // Chart update
        function updateChart() {
            let { months, balances } = calculateBalances(loans);

            updateLastPaymentDates();

            chart.setOption({
                animationDurationUpdate: 500,       // half a second
                animationEasingUpdate: 'cubicOut', // smooth easing
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'cross', label: { backgroundColor: '#6a7985' } },
                    valueFormatter: v => parseFloat(v).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }),
                    formatter: function (params) {
                        let axisVal = params[0].axisValue;
                        let match = axisVal.match(/Month (\d+)/);
                        let monthNum = match ? parseInt(match[1], 10) : 0;
                        let now = new Date();
                        let totalMonths = now.getMonth() + monthNum;
                        let year = now.getFullYear() + Math.floor(totalMonths / 12);
                        let month = (totalMonths % 12) + 1;
                        let monthName = new Date(year, month - 1, 1).toLocaleString('default', { month: 'short' });
                        let s = axisVal + ` (${monthName} ${year})<br/>`;
                        params.slice().reverse().forEach(function (item) {
                            s += '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:' + item.color + '"></span>';
                            s += item.seriesName + ': $' + parseFloat(item.data).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '<br/>';
                        });
                        return s;
                    }
                },
                legend: { data: loans.map(l => l.name) },
                toolbox: { feature: { saveAsImage: {} } },
                grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
                xAxis: [{ type: 'category', boundaryGap: false, data: months.map(m => `Month ${m}`) }],
                yAxis: [{ type: 'value', name: 'Balance ($)' }],
                series: loans.map((loan, idx) => ({
                    name: loan.name,
                    type: 'line',
                    stack: 'Total',
                    smooth: true,
                    lineStyle: { width: 0 },
                    showSymbol: false,
                    lineStyle: { width: 2, color: getGradientColor(idx, true) }, // match top gradient
                    itemStyle: { color: getGradientColor(idx, true) },           // legend color
                    areaStyle: {
                        opacity: 0.8,
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: getGradientColor(idx, true) },
                            { offset: 1, color: getGradientColor(idx, false) }
                        ])
                    },
                    emphasis: { focus: 'series' },
                    data: balances[idx]
                }))
            });
        }

        function getGradientColor(i, top) {
            const palette = [
                ['#ff7f50', '#ffdab9'], // coral â†’ peachpuff
                ['#87cefa', '#e0ffff'], // light sky blue â†’ light cyan
                ['#da70d6', '#dda0dd'], // orchid â†’ plum
                ['#32cd32', '#98fb98'], // lime green â†’ pale green
                ['#ffd700', '#fffacd'], // gold â†’ lemon chiffon
                ['#ff69b4', '#ffc0cb'], // hot pink â†’ pink
                ['#40e0d0', '#afeeee'], // turquoise â†’ pale turquoise
                ['#ba55d3', '#d8bfd8'], // medium orchid â†’ thistle
                ['#ff8c00', '#ffdead'], // dark orange â†’ navajo white
                ['#228b22', '#90ee90'], // forest green â†’ light green
                ['#1e90ff', '#add8e6'], // dodger blue â†’ light blue
                ['#8b0000', '#f08080'], // dark red â†’ light coral
                ['#9932cc', '#e6e6fa'], // dark orchid â†’ lavender
                ['#2e8b57', '#98fb98'], // sea green â†’ pale green
                ['#ff1493', '#ffb6c1']  // deep pink â†’ light pink
            ];
            return palette[i % palette.length][top ? 0 : 1];
        }

        // Initial render
        renderControls();
        updateChart();
    </script>
    <!-- Buy Me a Coffee Floating Button -->
    <div class="bmc-float">
        <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js"
            data-name="bmc-button" data-slug="bobKaram" data-color="#5F7FFF" data-emoji="ðŸº" data-font="Comic"
            data-text="Cheers to your Goals" data-outline-color="#000000" data-font-color="#ffffff"
            data-coffee-color="#FFDD00"></script>
    </div>
</body>

</html>